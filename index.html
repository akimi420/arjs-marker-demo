<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>AR.js Jack-in-the-Box üéÅ</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    <style>
      body, html { margin: 0; overflow: hidden; background: black; }
    </style>
  </head>

  <body>
    <a-scene embedded arjs="sourceType: webcam;">
      <!-- „Éû„Éº„Ç´„Éº -->
      <a-marker preset="hiro" id="marker">
        <!-- ÁÆ±„ÅÆÊú¨‰Ωì -->
        <a-box id="box"
               position="0 0 0"
               depth="1" height="0.6" width="1"
               color="#8B4513"
               material="roughness:0.8; metalness:0.2;">
        </a-box>

        <!-- „Éï„ÇøÔºà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅßÈñã„ÅèÔºâ -->
        <a-box id="lid"
               position="0 0.3 0.5"
               depth="1" height="0.05" width="1"
               color="#A0522D"
               rotation="0 0 0"
               animation__open="property: rotation; to: -120 0 0; dur: 1200; easing: easeOutCubic; startEvents: openLid;">
        </a-box>

        <!-- ‰∏≠Ë∫´Ôºà„Å≥„Å£„Åè„Çä„Ç≠„É£„É©Ôºâ -->
        <a-sphere id="toy"
                  position="0 0.4 0"
                  radius="0.15"
                  color="#FFD700"
                  visible="false"
                  animation__pop="property: position; to: 0 1.4 0; dur: 800; easing: easeOutElastic; startEvents: popOut;">
        </a-sphere>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const marker = document.querySelector('#marker');
      const lid = document.querySelector('#lid');
      const toy = document.querySelector('#toy');

      // „Éû„Éº„Ç´„Éº„ÅåË¶ã„Å§„Åã„Å£„Åü„Çâ„ÄÅÊï∞ÁßíÂæå„Å´„Éï„Çø„ÅåÈñã„ÅÑ„Å¶‰∏≠Ë∫´„ÅåÈ£õ„Å≥Âá∫„Åô
      marker.addEventListener('markerFound', () => {
        console.log("üì∏ Marker detected! Starting box animation...");
        setTimeout(() => {
          lid.emit('openLid');
        }, 1000); // 1ÁßíÂæå„Å´„Éï„Çø„Ç™„Éº„Éó„É≥

        setTimeout(() => {
          toy.setAttribute('visible', true);
          toy.emit('popOut');
        }, 1800); // 1.8ÁßíÂæå„Å´È£õ„Å≥Âá∫„Åó
      });

      // „Éû„Éº„Ç´„Éº„ÇíË¶ãÂ§±„Å£„Åü„Çâ„É™„Çª„ÉÉ„Éà
      marker.addEventListener('markerLost', () => {
        toy.setAttribute('visible', false);
        lid.setAttribute('rotation', '0 0 0');
        toy.setAttribute('position', '0 0.4 0');
      });
    </script>
  </body>
</html>
