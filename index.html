<!DOCTYPE html>
<html lang="ja">
Â  <head>
Â  Â  <meta charset="utf-8">
Â  Â  <title>AR.js Mini Golf Demo âœ…</title>

Â  Â  Â  Â  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/cannon-es@0.20.0/dist/cannon-es.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>

Â  Â  <style>
Â  Â  Â  body, html { margin: 0; padding: 0; overflow: hidden; }
Â  Â  Â  .hint {
Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  bottom: 12px;
Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  Â  background: rgba(0,0,0,0.6);
Â  Â  Â  Â  color: #fff;
Â  Â  Â  Â  padding: 6px 10px;
Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  }
Â  Â  Â  .message {
Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  top: 40%;
Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  font-size: 40px;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  color: #00ff80;
Â  Â  Â  Â  text-shadow: 2px 2px 6px black;
Â  Â  Â  Â  display: none;
Â  Â  Â  }
Â  Â  </style>
Â  </head>

Â  <body>
Â  Â  Â  Â  <a-scene
Â  Â  Â  embedded
Â  Â  Â  arjs="sourceType: webcam;"
Â  Â  Â  physics="debug: false; gravity: 0 -9.8 0"
Â  Â  Â  vr-mode-ui="enabled: false"
Â  Â  >
Â  Â  Â  Â  Â  Â  <a-marker preset="hiro" id="marker">
Â  Â  Â  Â  Â  Â  Â  Â  <a-box id="floor"
Â  Â  Â  Â  Â  position="0 0 0"
Â  Â  Â  Â  Â  depth="4" height="0.1" width="4"
Â  Â  Â  Â  Â  color="#3FAF3F"
Â  Â  Â  Â  Â  static-body="friction: 0.6; restitution: 0.1;">
Â  Â  Â  Â  </a-box>

Â  Â  Â  Â  Â  Â  Â  Â  <a-box position="0 0.5 -2" depth="0.1" height="1" width="4" color="#2E8B57" static-body></a-box>
Â  Â  Â  Â  <a-box position="0 0.5 2" depth="0.1" height="1" width="4" color="#2E8B57" static-body></a-box>
Â  Â  Â  Â  <a-box position="-2 0.5 0" depth="4" height="1" width="0.1" color="#2E8B57" static-body></a-box>
Â  Â  Â  Â  <a-box position="2 0.5 0" depth="4" height="1" width="0.1" color="#2E8B57" static-body></a-box>

Â  Â  Â  Â  Â  Â  Â  Â  <a-cylinder id="hole"
Â  Â  Â  Â  Â  position="1.2 0.05 1.2"
Â  Â  Â  Â  Â  radius="0.25" height="0.1"
Â  Â  Â  Â  Â  color="black"
Â  Â  Â  Â  Â  static-body>
Â  Â  Â  Â  </a-cylinder>

Â  Â  Â  Â  Â  Â  Â  Â  <a-sphere id="ball"
Â  Â  Â  Â  Â  position="0 0.5 0"
Â  Â  Â  Â  Â  radius="0.25"
Â  Â  Â  Â  Â  color="#EF2D5E"
Â  Â  Â  Â  Â  dynamic-body="mass:1; linearDamping: 0.5; angularDamping: 0.5; friction: 0.6; restitution: 0.1;">
Â  Â  Â  Â  </a-sphere>
Â  Â  Â  </a-marker>

Â  Â  Â  <a-entity camera></a-entity>
Â  Â  </a-scene>

Â  Â  <div class="hint">ã‚¹ãƒãƒ›ã‚’å‚¾ã‘ã¦ãƒœãƒ¼ãƒ«ã‚’è»¢ãŒãã†ï¼</div>
Â  Â  <div class="message" id="message">ğŸ‰ Congratulations!! ğŸ‰</div>

Â  Â  <script>
Â  Â  Â  // --- iOSã§ã‚»ãƒ³ã‚µãƒ¼è¨±å¯ã‚’æ±‚ã‚ã‚‹ ---
Â  Â  Â  if (typeof DeviceOrientationEvent.requestPermission === 'function') {
Â  Â  Â  Â  document.body.addEventListener('click', () => {
Â  Â  Â  Â  Â  DeviceOrientationEvent.requestPermission();
Â  Â  Â  Â  });
Â  Â  Â  }

Â  Â  Â  // --- ã‚¹ãƒãƒ›ã®å‚¾ãã§é‡åŠ›ã‚’æ›´æ–° ---
Â  Â  Â  window.addEventListener('deviceorientation', (event) => {
Â  Â  Â  Â  const { beta, gamma } = event; // beta: å‰å¾Œ, gamma: å·¦å³
Â  Â  Â  Â  const sceneEl = document.querySelector('a-scene');
Â  Â  Â  Â  // physicsã‚·ã‚¹ãƒ†ãƒ ãŒãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ã‹ç¢ºèª
Â  Â  Â  Â  const world = sceneEl.systems.physics?.driver?.world; 
Â  Â  Â  Â  if (!world) return;

Â  Â  Â  Â  // è»¢ãŒã‚Šã‚„ã™ã•ã®ãŸã‚å€ç‡ã‚’å°‘ã—ä¸Šã’ã‚‹ (45åº¦å‚¾ã‘ãŸã¨ãã«æœ€å¤§é‡åŠ›ã«ãªã‚‹ã‚ˆã†èª¿æ•´)
Â  Â  Â  Â  const gx = (gamma / 45) * 9.8;
Â  Â  Â  Â  const gz = (beta / 45) * 9.8;

Â  Â  Â  Â  // X-Zå¹³é¢ã®é‡åŠ›ã®ã¿ã‚’æ›´æ–°ã—ã€Yè»¸ã¯å¸¸ã«ä¸‹å‘ã (-9.8) ã‚’ç¶­æŒã™ã‚‹
Â  Â  Â  Â  world.gravity.set(gx, -9.8, gz);
Â  Â  Â  });

Â  Â  Â  // --- ã‚´ãƒ¼ãƒ«åˆ¤å®šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ---
Â  Â  Â  AFRAME.registerComponent('goal-check', {
Â  Â  Â  Â  init: function() {
Â  Â  Â  Â  Â  this.isGoal = false; // ã‚´ãƒ¼ãƒ«çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹ãƒ•ãƒ©ã‚°
Â  Â  Â  Â  },
Â  Â  Â  Â  tick: function () {
Â  Â  Â  Â  Â  if (this.isGoal) return; // ã™ã§ã«ã‚´ãƒ¼ãƒ«ã—ã¦ã„ãŸã‚‰å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  const ball = document.querySelector('#ball');
Â  Â  Â  Â  Â  const hole = document.querySelector('#hole');
Â  Â  Â  Â  Â  const floor = document.querySelector('#floor'); // åºŠã‚’å–å¾—
Â  Â  Â  Â  Â  const msg = document.querySelector('#message');
Â  Â  Â  Â  Â  if (!ball || !hole || !floor) return;

Â  Â  Â  Â  Â  const bPos = ball.object3D.position;
Â  Â  Â  Â  Â  const hPos = hole.object3D.position;
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  // 2æ¬¡å…ƒã®è·é›¢ã‚’è¨ˆç®— (Yè»¸ã‚’ç„¡è¦–)
Â  Â  Â  Â  Â  const distSq = (bPos.x - hPos.x)**2 + (bPos.z - hPos.z)**2;
Â  Â  Â  Â  Â  const dist = Math.sqrt(distSq);

Â  Â  Â  Â  Â  // ç©´ã®åŠå¾„ (0.25) ã«è¿‘ã¥ã„ãŸã‚‰
Â  Â  Â  Â  Â  if (dist < 0.25) {
Â  Â  Â  Â  Â  Â  // 1. åºŠã®ç‰©ç†ä½“(static-body)ã‚’ç„¡åŠ¹åŒ–ã—ã€ãƒœãƒ¼ãƒ«ãŒè½ã¡ã‚‹ã‚ˆã†ã«ã™ã‚‹
Â  Â  Â  Â  Â  Â  floor.removeAttribute('static-body');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // 2. ãƒœãƒ¼ãƒ«ãŒåºŠã®åšã•ä»¥ä¸‹ï¼ˆyåº§æ¨™ãŒååˆ†ã«ä½ã„ï¼‰ã¾ã§è½ã¡ãŸã‚‰ã‚´ãƒ¼ãƒ«ã¨åˆ¤å®š
Â  Â  Â  Â  Â  Â  if (bPos.y < 0.05) { 
Â  Â  Â  Â  Â  Â  Â  this.isGoal = true;
Â  Â  Â  Â  Â  Â  Â  msg.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  // ã‚´ãƒ¼ãƒ«å¾Œã€ãƒœãƒ¼ãƒ«ã®å‹•ãã‚’æ­¢ã‚ã‚‹
Â  Â  Â  Â  Â  Â  Â  ball.body.velocity.set(0, 0, 0);
Â  Â  Â  Â  Â  Â  Â  ball.body.angularVelocity.set(0, 0, 0);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  document.querySelector('a-scene').setAttribute('goal-check', '');
Â  Â  </script>
Â  </body>
</html>
